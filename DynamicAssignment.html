<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Dynamic Assignment &mdash; SWAP-IT Execution Engine 0.9.9 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=19f00094" />

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="_static/jquery.js?v=5d32c60e"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="_static/documentation_options.js?v=be50ab7b"></script>
        <script src="_static/doctools.js?v=9a2dae69"></script>
        <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Service Specific Assignment" href="ServiceSpecificAssignment.html" />
    <link rel="prev" title="Default Assignment" href="DefaultAssignment.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            SWAP-IT Execution Engine
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="GettingStarted.html">Getting Started</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="GettingStarted.html#start-an-execution-engine">Start an Execution Engine</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="GettingStarted.html#tutorials">Tutorials</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="StaticAssignment.html">Static Assignment</a></li>
<li class="toctree-l3"><a class="reference internal" href="DefaultAssignment.html">Default Assignment</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Dynamic Assignment</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#pfdl-definition">PFDL Definition</a></li>
<li class="toctree-l4"><a class="reference internal" href="#process-execution">Process Execution</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="ServiceSpecificAssignment.html">Service Specific Assignment</a></li>
<li class="toctree-l3"><a class="reference internal" href="ServiceSpecificDeviceRegistry.html">Service Specific Device Registry</a></li>
<li class="toctree-l3"><a class="reference internal" href="CapabilityBasedAssignment.html">Capability-based Assignment</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="GettingStarted.html#configure-an-execution-engine">Configure an Execution Engine</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="ExecutionEngineLogic.html">Execution Engine Logic</a></li>
<li class="toctree-l1"><a class="reference internal" href="Dispatcher.html">Dispatcher Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="ControlInterface.html">Control Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="Glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="Contact.html">Contact</a></li>
<li class="toctree-l1"><a class="reference internal" href="related_projects.html">Related-Projects</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">SWAP-IT Execution Engine</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="GettingStarted.html">Getting Started</a></li>
      <li class="breadcrumb-item active">Dynamic Assignment</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/DynamicAssignment.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="dynamic-assignment">
<h1>Dynamic Assignment<a class="headerlink" href="#dynamic-assignment" title="Link to this heading"></a></h1>
<p>The <a class="reference external" href="https://github.com/swap-it/demo-scenario">Demonstration Scenario</a> defines a structure SWAP_Order that must be handed over to each service to be executed.
For the Dynamic Assignment, a Device Registry is required, as well as an external assignment agent. The assignment agent will be globally registered in the execution engine,
so that it is considered for each assignment step.</p>
<section id="pfdl-definition">
<h2>PFDL Definition<a class="headerlink" href="#pfdl-definition" title="Link to this heading"></a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">Struct</span> <span class="n">SWAP_Order</span>
    <span class="n">order_id</span><span class="p">:</span><span class="n">number</span>
    <span class="n">stand</span><span class="p">:</span><span class="n">Stand_Segment</span>
    <span class="n">segments</span><span class="p">:</span> <span class="n">Light_Segment</span><span class="p">[]</span>
    <span class="n">number_light_segments</span><span class="p">:</span> <span class="n">number</span>
<span class="n">End</span>

<span class="n">Struct</span> <span class="n">Stand_Segment</span>
        <span class="n">stand_shape</span><span class="p">:</span><span class="n">string</span>
        <span class="n">stand_height</span><span class="p">:</span><span class="n">number</span>
        <span class="n">stand_id</span><span class="p">:</span><span class="n">string</span>
<span class="n">End</span>

<span class="n">Struct</span> <span class="n">Light_Segment</span>
        <span class="n">color</span><span class="p">:</span> <span class="n">string</span>
        <span class="n">diameter</span><span class="p">:</span> <span class="n">number</span>
        <span class="n">segment_id</span><span class="p">:</span><span class="n">string</span>
<span class="n">End</span>

<span class="n">Task</span> <span class="n">productionTask</span>
        <span class="n">manufacture_light_segments</span>
            <span class="n">In</span>
                <span class="n">SWAP_Order</span>
                <span class="p">{</span>
                    <span class="s2">&quot;order_id&quot;</span><span class="p">:</span><span class="mi">1000</span><span class="p">,</span>
                    <span class="s2">&quot;stand&quot;</span><span class="p">:{</span>
                        <span class="s2">&quot;stand_shape&quot;</span><span class="p">:</span><span class="s2">&quot;plate&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;stand_height&quot;</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span>
                        <span class="s2">&quot;stand_id&quot;</span><span class="p">:</span> <span class="s2">&quot;Default&quot;</span>
                    <span class="p">},</span>
                    <span class="s2">&quot;segments&quot;</span><span class="p">:</span>
                    <span class="p">[</span>
                    <span class="p">{</span>
                        <span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="s2">&quot;red&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;diameter&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
                        <span class="s2">&quot;segment_id&quot;</span><span class="p">:</span> <span class="s2">&quot;Default&quot;</span>
                    <span class="p">},</span>
                    <span class="p">{</span>
                        <span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="s2">&quot;green&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;diameter&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
                        <span class="s2">&quot;segment_id&quot;</span><span class="p">:</span> <span class="s2">&quot;Default&quot;</span>
                    <span class="p">}</span>
                    <span class="p">],</span>
                    <span class="s2">&quot;number_light_segments&quot;</span><span class="p">:</span> <span class="mi">5</span>
                <span class="p">}</span>

<span class="n">End</span>

<span class="n">Task</span> <span class="n">manufacture_light_segments</span>
        <span class="n">In</span>
            <span class="n">order</span><span class="p">:</span> <span class="n">SWAP_Order</span>
        <span class="n">Parallel</span> <span class="n">Loop</span> <span class="n">i</span> <span class="n">To</span> <span class="n">order</span><span class="o">.</span><span class="n">number_light_segments</span>
            <span class="n">manufacture_light_segment</span>
                <span class="n">In</span>
                    <span class="n">order</span>
                <span class="n">Out</span>
                    <span class="n">order</span><span class="p">:</span><span class="n">SWAP_Order</span>
        <span class="n">Loop</span> <span class="n">i</span> <span class="n">To</span> <span class="n">order</span><span class="o">.</span><span class="n">number_light_segments</span>
            <span class="n">Gluing</span>
                <span class="n">In</span>
                    <span class="n">order</span>
                <span class="n">Out</span>
                    <span class="n">order</span><span class="p">:</span><span class="n">SWAP_Order</span>
<span class="n">End</span>

<span class="n">Task</span> <span class="n">manufacture_light_segment</span>
        <span class="n">In</span>
            <span class="n">order</span><span class="p">:</span> <span class="n">SWAP_Order</span>
        <span class="n">GetPartsFromWarehouse</span>
            <span class="n">In</span>
                <span class="n">order</span>
            <span class="n">Out</span>
                <span class="n">order</span><span class="p">:</span> <span class="n">SWAP_Order</span>
        <span class="n">Coating</span>
            <span class="n">In</span>
                <span class="n">order</span>
            <span class="n">Out</span>
                <span class="n">order</span><span class="p">:</span> <span class="n">SWAP_Order</span>
        <span class="n">Out</span>
            <span class="n">order</span>
<span class="n">End</span>
</pre></div>
</div>
</section>
<section id="process-execution">
<h2>Process Execution<a class="headerlink" href="#process-execution" title="Link to this heading"></a></h2>
<p>To execute the above-defined PFDL-process, a small <a class="reference external" href="https://github.com/FraunhoferIOSB/swap-it-execution-engine/blob/main/Tutorial/dynamic_assignment.py">python script</a> is required to set up the execution engine and the docker environment:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">time</span><span class="o">,</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">sys</span>
<span class="c1">#add directories to the system path</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">),</span> <span class="s2">&quot;../.&quot;</span><span class="p">))</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">),</span> <span class="s2">&quot;../tests/test_helpers/.&quot;</span><span class="p">))</span>
<span class="c1">#import the main function</span>
<span class="kn">from</span> <span class="nn">main</span> <span class="kn">import</span> <span class="n">main</span>
<span class="c1">#import the docker environment</span>
<span class="kn">from</span> <span class="nn">util.start_docker_compose</span> <span class="kn">import</span> <span class="n">DockerComposeEnvironment</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="c1">#configure the required docker environment</span>
    <span class="n">env</span> <span class="o">=</span> <span class="n">DockerComposeEnvironment</span><span class="p">([</span><span class="s2">&quot;Device_Registry&quot;</span><span class="p">,</span> <span class="s2">&quot;Service_Server&quot;</span><span class="p">,</span> <span class="s2">&quot;Dashboard&quot;</span><span class="p">,</span> <span class="s2">&quot;Assignment_Agent&quot;</span><span class="p">])</span>
    <span class="c1">#start the docker environment</span>
    <span class="n">env</span><span class="o">.</span><span class="n">run_docker_compose</span><span class="p">(</span><span class="s2">&quot;./Tutorial/docker-compose.yaml&quot;</span><span class="p">)</span>
    <span class="c1">#wait until the server started</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
    <span class="c1">#run the execution engine</span>
    <span class="n">main</span><span class="p">()</span>
    <span class="c1">#shut down the docker environment</span>
    <span class="n">env</span><span class="o">.</span><span class="n">stop_docker_compose</span><span class="p">()</span>
</pre></div>
</div>
<p>Here, we first need to add the root directory of the repository to the system path to import the main function of the execution engine. Beside, we can re-use the
docker-environment from the test section.</p>
<p>For this Tutorial, the terminal command must be extended with three of the optional arguments. First, a global Device Registry is set with the argument <em>“device_registry_url”=”opc.tcp://localhost:8000”</em>. Besides,
each service server registers itself in the Device Registry with the URI from the docker compose environment, so that the URI returned from the
Device Registry must ab adjusted, to replace the docker-internal URI with a docker-external URI. Here, the optional argument <em>“custom_url”=”opc.tcp://localhost:”</em> is added, so that each server from the
docker-environment can be reached from outside. Lastly, an assignment agent is globally registered with the argument <em>“assignment_agent_url”=”opc.tcp://localhost:10000”</em>. In addition to that,
we will set another argument, to increase the number of default clients for the execution engine’s control interface. Here, the argument <em>“number_default_clients”=5</em> is provided, so that the execution
engine starts with a set of 5 control interface clients.</p>
<p>The process can then be executed from the command line with:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">Tutorial</span><span class="o">/</span><span class="n">dynamic_assignment</span><span class="o">.</span><span class="n">py</span> <span class="s2">&quot;opc.tcp://localhost:4840&quot;</span> <span class="s2">&quot;Tutorial/PFDL/dynamic_assignment.pfdl&quot;</span> <span class="s2">&quot;dashboard_host_address&quot;</span><span class="o">=</span><span class="s2">&quot;http://localhost:8080&quot;</span> <span class="s2">&quot;device_registry_url&quot;</span><span class="o">=</span><span class="s2">&quot;opc.tcp://localhost:8000&quot;</span> <span class="s2">&quot;custom_url&quot;</span><span class="o">=</span><span class="s2">&quot;opc.tcp://localhost:&quot;</span> <span class="s2">&quot;number_default_clients&quot;</span><span class="o">=</span><span class="mi">5</span> <span class="s2">&quot;assignment_agent_url&quot;</span><span class="o">=</span><span class="s2">&quot;opc.tcp://localhost:10000&quot;</span>
</pre></div>
</div>
<p>so that we can execute the process and map it on the <a class="reference external" href="https://github.com/iml130/swap-it-dashboard">SWAP-IT Dashboard</a>. In case that the log messages of the execution
engine should be captured, the command line argument can be simply adjusted to:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">Tutorial</span><span class="o">/</span><span class="n">dynamic_assignment</span><span class="o">.</span><span class="n">py</span> <span class="s2">&quot;opc.tcp://localhost:4840&quot;</span> <span class="s2">&quot;Tutorial/PFDL/dynamic_assignment.pfdl&quot;</span> <span class="s2">&quot;dashboard_host_address&quot;</span><span class="o">=</span><span class="s2">&quot;http://localhost:8080&quot;</span> <span class="s2">&quot;log_info&quot;</span><span class="o">=</span><span class="kc">True</span> <span class="s2">&quot;device_registry_url&quot;</span><span class="o">=</span><span class="s2">&quot;opc.tcp://localhost:8000&quot;</span> <span class="s2">&quot;custom_url&quot;</span><span class="o">=</span><span class="s2">&quot;opc.tcp://localhost:&quot;</span> <span class="s2">&quot;number_default_clients&quot;</span><span class="o">=</span><span class="mi">5</span> <span class="s2">&quot;assignment_agent_url&quot;</span><span class="o">=</span><span class="s2">&quot;opc.tcp://localhost:10000&quot;</span>
</pre></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="DefaultAssignment.html" class="btn btn-neutral float-left" title="Default Assignment" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="ServiceSpecificAssignment.html" class="btn btn-neutral float-right" title="Service Specific Assignment" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Fraunhofer IOSB Author (Florian Düwel).</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(false);
      });
  </script> 

</body>
</html>